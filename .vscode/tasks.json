{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "安装前端依赖",
      "type": "shell",
      "command": "npm",
      "args": ["install"],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": true,
        "clear": false
      },
      "problemMatcher": []
    },
    {
      "label": "启动前端开发服务器",
      "type": "shell",
      "command": "npm",
      "args": ["run", "serve"],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": true,
        "clear": false
      },
      "problemMatcher": [],
      "isBackground": true
    },
    {
      "label": "构建前端",
      "type": "shell",
      "command": "npm",
      "args": ["run", "build"],
      "group": {
        "kind": "build",
        "isDefault": true
      },
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": true,
        "clear": false
      },
      "problemMatcher": []
    },
    {
      "label": "前端代码检查",
      "type": "shell",
      "command": "npm",
      "args": ["run", "lint"],
      "group": "test",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": true,
        "clear": false
      },
      "problemMatcher": ["$eslint-stylish"]
    },
    {
      "label": "配置 CMake (后端)",
      "type": "shell",
      "command": "cmake",
      "args": [
        "-B", "${workspaceFolder}/backend/build",
        "-S", "${workspaceFolder}/backend",
        "-DCMAKE_TOOLCHAIN_FILE=${VCPKG_ROOT}/scripts/buildsystems/vcpkg.cmake",
        "-DCMAKE_BUILD_TYPE=Debug"
      ],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": true,
        "clear": false
      },
      "problemMatcher": ["$gcc"]
    },
    {
      "label": "构建 C++ 后端",
      "type": "shell",
      "command": "cmake",
      "args": [
        "--build", "${workspaceFolder}/backend/build",
        "--config", "Debug",
        "-j", "4"
      ],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": true,
        "clear": false
      },
      "problemMatcher": ["$gcc"],
      "dependsOn": "配置 CMake (后端)"
    },
    {
      "label": "运行后端",
      "type": "shell",
      "command": "${workspaceFolder}/backend/build/low_altitude_traffic_system_backend",
      "args": [],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": true,
        "clear": false
      },
      "problemMatcher": [],
      "dependsOn": "构建 C++ 后端",
      "options": {
        "env": {
          "DB_HOST": "mysql",
          "DB_PORT": "3306",
          "DB_NAME": "low_altitude_traffic",
          "DB_USER": "appuser",
          "DB_PASSWORD": "apppassword"
        }
      }
    },
    {
      "label": "清理构建 (后端)",
      "type": "shell",
      "command": "rm",
      "args": ["-rf", "${workspaceFolder}/backend/build"],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": true,
        "clear": false
      }
    },
    {
      "label": "检查数据库连接",
      "type": "shell",
      "command": "mysql",
      "args": [
        "-h", "mysql",
        "-u", "appuser",
        "-papppassword",
        "-e", "SELECT 'Database connection successful!' as status;"
      ],
      "group": "test",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": true,
        "clear": false
      },
      "problemMatcher": []
    }
  ]
}