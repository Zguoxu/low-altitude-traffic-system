# 地图右键菜单调试说明

## 修复内容

我已经对地图右键菜单功能进行了以下改进：

### ✅ 事件绑定优化
- **右键点击**: 主要触发方式（符合用户习惯）
- **双击**: 备用触发方式（保持兼容）
- **阻止默认**: 阻止浏览器默认右键菜单

### ✅ 坐标计算优化
- 使用 `map.lngLatToContainer()` 方法（v2.0兼容）
- 添加边界检测，防止菜单超出屏幕
- 添加调试日志便于排查问题

### ✅ 样式改进
- 使用 `position: fixed` 定位
- 添加高层级 `z-index: 9999`
- 禁用文本选择 `user-select: none`

## 测试步骤

### 方法1：右键点击（推荐）
1. 访问 http://localhost:8087/map
2. **右键单击**地图任意位置
3. 应该弹出包含4个选项的菜单

### 方法2：双击（备用）
1. 访问 http://localhost:8087/map
2. **左键双击**地图任意位置
3. 应该弹出相同的菜单

## 调试方法

### 打开开发者工具
1. 按 `F12` 打开开发者工具
2. 切换到 `Console` 选项卡
3. 右键或双击地图
4. 查看控制台输出

### 预期日志输出
```
显示菜单，坐标: {lng: 116.397428, lat: 39.90923}
屏幕坐标: {x: 300, y: 200}
菜单位置: 300 200
```

### 可能的错误信息
如果出现错误，会看到类似：
```
无法获取有效的屏幕坐标: null
显示菜单时出错: [错误详情]
```

## 菜单选项说明

弹出的菜单包含以下4个选项：
- 🏁 **设置为起点** - 设置路线规划的起始点
- 📍 **设置为途经点** - 添加路线途经点
- 🎯 **设置为终点** - 设置路线规划的终点
- ❌ **清除路线** - 清空所有路线设置

## 如果仍然无法弹出菜单

### 可能原因1：事件冲突
- 地图可能有其他事件监听器
- 尝试在地图的空白区域（非标记点）右键

### 可能原因2：坐标转换失败
- 检查控制台是否有错误日志
- 确认使用的是高德地图 v2.0 API

### 可能原因3：CSS样式问题
- 菜单可能被其他元素遮挡
- 检查 `z-index` 层级

### 可能原因4：JavaScript错误
- 打开开发者工具检查是否有JavaScript错误
- 刷新页面重新加载

## 临时测试方案

如果右键菜单仍然有问题，你可以：

### 1. 手动设置坐标
在控制台中执行：
```javascript
// 手动设置起点
window.testSetStart = () => {
  // 模拟点击起点设置
  console.log('手动设置起点')
}
```

### 2. 使用固定按钮
我可以添加几个测试按钮到页面上，让你直接点击设置路线点。

## 请反馈

请告诉我：
1. 右键点击是否能弹出菜单？
2. 双击是否能弹出菜单？
3. 控制台有什么错误信息？
4. 是否需要我添加临时的测试按钮？

这样我可以进一步优化代码！